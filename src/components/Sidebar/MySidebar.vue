<template>
  <aside class="sidebar" :class="`${ isToggled ? 'expanded' : '' }`">
      <div class="sidebar__body">
         <router-link to="/">
            <div class="sidebar__logo">
               <img src="@/assets/img/logo.png" alt="Logo">
            </div>
         </router-link>
         <div class="sidebar__dropdown dropdown" v-if="!isTokenActive" @mouseenter="openDropdown" @mouseleave="closeDropdown">
            <div class="dropdown__content" :class="`${ isDropdowned ? 'hovered' : '' }`">
               <div class="dropdown__avatar">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                     <path d="M12 0C5.4 0 0 5.4 0 12C0 18.6 5.4 24 12 24C18.6 24 24 18.6 24 12C24 5.4 18.6 0 12 0ZM12 4C14.2 4 16 6.2 16 9C16 11.8 14.2 14 12 14C9.8 14 8 11.8 8 9C8 6.2 9.8 4 12 4ZM18.6 19.5C16.9 21 14.5 22 12 22C9.5 22 7.1 21 5.4 19.5C5 19.1 4.9 18.5 5.3 18.1C6.4 16.8 7.9 15.9 9.5 15.4C10.3 15.8 11.1 16 12 16C12.9 16 13.7 15.8 14.5 15.4C16.2 15.9 17.6 16.8 18.7 18.1C19.1 18.5 19.1 19.1 18.6 19.5Z" fill="black"/>
                  </svg>
               </div>
               <div class="dropdown__text">Account</div>
            </div>
            <nav class="dropdown__menu" :class="`${ isDropdowned ? 'expanded' : '' }`">
               <router-link to="/login">
                  <button type="button" class="dropdown__login">Login</button>
               </router-link>
               <router-link to="/register">
                  <div class="dropdown__link">
                     <div class="dropdown__icon">
                        <svg width="96" height="96" viewBox="0 0 96 96" fill="none" xmlns="http://www.w3.org/2000/svg">
                           <path d="M43.7578 61.7579C43.1982 62.3144 42.7538 62.9759 42.4503 63.7044C42.1467 64.433 41.9899 65.2142 41.9888 66.0035C41.9877 66.7928 42.1423 67.5745 42.4439 68.3039C42.7454 69.0333 43.1879 69.696 43.746 70.2541C44.3041 70.8122 44.9668 71.2546 45.6962 71.5562C46.4256 71.8577 47.2073 72.0123 47.9965 72.0112C48.7858 72.0102 49.5671 71.8533 50.2956 71.5498C51.0242 71.2462 51.6857 70.8019 52.2422 70.2423L70.2422 52.2422C70.7995 51.6853 71.2415 51.0239 71.5431 50.296C71.8448 49.5681 72 48.788 72 48C72 47.2121 71.8448 46.432 71.5431 45.7041C71.2415 44.9762 70.7995 44.3148 70.2422 43.7578L52.2422 25.7578C51.116 24.6379 49.5917 24.0102 48.0035 24.0125C46.4152 24.0147 44.8926 24.6466 43.7696 25.7696C42.6465 26.8927 42.0146 28.4153 42.0124 30.0035C42.0102 31.5918 42.6379 33.1161 43.7578 34.2422L51.5156 42H6C4.4087 42 2.88258 42.6322 1.75736 43.7574C0.632141 44.8826 0 46.4087 0 48C0 49.5913 0.632141 51.1175 1.75736 52.2427C2.88258 53.3679 4.4087 54 6 54H51.5156L43.7578 61.7579Z" fill="black"/>
                           <path d="M90 9.64515e-07H30C29.2119 -0.000445981 28.4315 0.154444 27.7034 0.455813C26.9752 0.757183 26.3136 1.19912 25.7564 1.75636C25.1991 2.3136 24.7572 2.97522 24.4558 3.70337C24.1544 4.43153 23.9996 5.21194 24 6V18C24 19.5913 24.6321 21.1174 25.7574 22.2426C26.8826 23.3679 28.4087 24 30 24C31.5913 24 33.1174 23.3679 34.2426 22.2426C35.3679 21.1174 36 19.5913 36 18V12H84V84H36V78C36 76.4087 35.3679 74.8826 34.2426 73.7574C33.1174 72.6321 31.5913 72 30 72C28.4087 72 26.8826 72.6321 25.7574 73.7574C24.6321 74.8826 24 76.4087 24 78V90C23.9996 90.7881 24.1544 91.5685 24.4558 92.2966C24.7572 93.0248 25.1991 93.6864 25.7564 94.2436C26.3136 94.8009 26.9752 95.2428 27.7034 95.5442C28.4315 95.8456 29.2119 96.0004 30 96H90C90.7881 96.0004 91.5685 95.8456 92.2966 95.5442C93.0248 95.2428 93.6864 94.8009 94.2436 94.2436C94.8009 93.6864 95.2428 93.0248 95.5442 92.2966C95.8456 91.5685 96.0004 90.7881 96 90V6C96.0004 5.21194 95.8456 4.43153 95.5442 3.70337C95.2428 2.97522 94.8009 2.3136 94.2436 1.75636C93.6864 1.19912 93.0248 0.757183 92.2966 0.455813C91.5685 0.154444 90.7881 -0.000445981 90 9.64515e-07V9.64515e-07Z" fill="black"/>
                        </svg>
                     </div>
                     <div class="dropdown__text">Registration</div>
                  </div>
               </router-link>
            </nav>
            <div class="dropdown__chevron-down" :class="`${ isDropdowned ? 'rotate' : '' }`">
               <svg width="768" height="384" viewBox="0 0 768 384" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0 0L383.75 383.75L767.5 0H0Z" fill="black"/>
               </svg>
            </div>
         </div>
         <router-link to="/user">
            <div class="sidebar__user" v-if="isTokenActive">
               <div class="sidebar__user-icon">
                 <img :src="user.avatar" alt="user icon">
               </div>
               <div class="sidebar__user-name">
                  {{ user.email }}
               </div>
            </div>
         </router-link>
         <div class="sidebar__menu menu">
            <div class="menu__toggle">
               <button class="menu__btn" @click="menuToggle">
                  <svg width="32" height="32" viewBox="0 0 400 322" fill="none" xmlns="http://www.w3.org/2000/svg">
                     <path d="M200.3 178L64.3 314C54.9 323.4 39.7 323.4 30.4 314L7.8 291.4C-1.6 282 -1.6 266.8 7.8 257.5L104.2 161.1L7.8 64.6999C-1.6 55.2999 -1.6 40.1 7.8 30.8L30.3 7.99995C39.7 -1.40005 54.9 -1.40005 64.2 7.99995L200.2 144C209.7 153.4 209.7 168.6 200.3 178V178ZM392.3 144L256.3 7.99995C246.9 -1.40005 231.7 -1.40005 222.4 7.99995L199.8 30.5999C190.4 39.9999 190.4 55.2 199.8 64.5L296.2 160.9L199.8 257.3C190.4 266.7 190.4 281.9 199.8 291.2L222.4 313.8C231.8 323.2 247 323.2 256.3 313.8L392.3 177.8C401.7 168.6 401.7 153.4 392.3 144Z" fill="black"/>
                  </svg>
               </button>
            </div>
            <h3 class="menu__title">Menu</h3>
            <nav class="menu__list">
               <router-link to="/">
                  <div class="menu__link">
                     <div class="menu__icon">
                        <svg width="20" height="18" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                           <path fill-rule="evenodd" clip-rule="evenodd" d="M8 17.5V11.5H12V17.5H17V9.5H20L10 0.5L0 9.5H3V17.5H8Z" fill="black"/>
                        </svg>
                     </div>
                     <span class="menu__text">Home</span>
                  </div>
               </router-link>
               <router-link to="/library" v-if="isTokenActive">
                  <div class="menu__link">
                     <div class="menu__icon">
                        <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                           <path d="M36 0H12C9.79 0 8 1.79 8 4V28C8 30.21 9.79 32 12 32H36C38.21 32 40 30.21 40 28V4C40 1.79 38.21 0 36 0ZM32 10H26V21C26 23.76 23.76 26 21 26C18.24 26 16 23.76 16 21C16 18.24 18.24 16 21 16C22.13 16 23.16 16.39 24 17.02V6H32V10ZM4 8H0V36C0 38.21 1.79 40 4 40H32V36H4V8Z" fill="black"/>
                        </svg>
                     </div>
                     <span class="menu__text">Library</span>
                  </div>
               </router-link>
               <router-link to="/login">
                  <div @click.stop="$store.dispatch('reg/logout')" class="menu__link" v-if="isTokenActive">
                     <div class="menu__icon">
                        <svg width="96" height="96" viewBox="0 0 96 96" fill="none" xmlns="http://www.w3.org/2000/svg">
                           <path d="M43.7578 61.7579C43.1982 62.3144 42.7538 62.9759 42.4503 63.7044C42.1467 64.433 41.9899 65.2142 41.9888 66.0035C41.9877 66.7928 42.1423 67.5745 42.4439 68.3039C42.7454 69.0333 43.1879 69.696 43.746 70.2541C44.3041 70.8122 44.9668 71.2546 45.6962 71.5562C46.4256 71.8577 47.2073 72.0123 47.9965 72.0112C48.7858 72.0102 49.5671 71.8533 50.2956 71.5498C51.0242 71.2462 51.6857 70.8019 52.2422 70.2423L70.2422 52.2422C70.7995 51.6853 71.2415 51.0239 71.5431 50.296C71.8448 49.5681 72 48.788 72 48C72 47.2121 71.8448 46.432 71.5431 45.7041C71.2415 44.9762 70.7995 44.3148 70.2422 43.7578L52.2422 25.7578C51.116 24.6379 49.5917 24.0102 48.0035 24.0125C46.4152 24.0147 44.8926 24.6466 43.7696 25.7696C42.6465 26.8927 42.0146 28.4153 42.0124 30.0035C42.0102 31.5918 42.6379 33.1161 43.7578 34.2422L51.5156 42H6C4.4087 42 2.88258 42.6322 1.75736 43.7574C0.632141 44.8826 0 46.4087 0 48C0 49.5913 0.632141 51.1175 1.75736 52.2427C2.88258 53.3679 4.4087 54 6 54H51.5156L43.7578 61.7579Z" fill="black"/>
                           <path d="M90 9.64515e-07H30C29.2119 -0.000445981 28.4315 0.154444 27.7034 0.455813C26.9752 0.757183 26.3136 1.19912 25.7564 1.75636C25.1991 2.3136 24.7572 2.97522 24.4558 3.70337C24.1544 4.43153 23.9996 5.21194 24 6V18C24 19.5913 24.6321 21.1174 25.7574 22.2426C26.8826 23.3679 28.4087 24 30 24C31.5913 24 33.1174 23.3679 34.2426 22.2426C35.3679 21.1174 36 19.5913 36 18V12H84V84H36V78C36 76.4087 35.3679 74.8826 34.2426 73.7574C33.1174 72.6321 31.5913 72 30 72C28.4087 72 26.8826 72.6321 25.7574 73.7574C24.6321 74.8826 24 76.4087 24 78V90C23.9996 90.7881 24.1544 91.5685 24.4558 92.2966C24.7572 93.0248 25.1991 93.6864 25.7564 94.2436C26.3136 94.8009 26.9752 95.2428 27.7034 95.5442C28.4315 95.8456 29.2119 96.0004 30 96H90C90.7881 96.0004 91.5685 95.8456 92.2966 95.5442C93.0248 95.2428 93.6864 94.8009 94.2436 94.2436C94.8009 93.6864 95.2428 93.0248 95.5442 92.2966C95.8456 91.5685 96.0004 90.7881 96 90V6C96.0004 5.21194 95.8456 4.43153 95.5442 3.70337C95.2428 2.97522 94.8009 2.3136 94.2436 1.75636C93.6864 1.19912 93.0248 0.757183 92.2966 0.455813C91.5685 0.154444 90.7881 -0.000445981 90 9.64515e-07V9.64515e-07Z" fill="black"/>
                        </svg>
                     </div>
                     <span class="menu__text">Sign out</span>
                  </div>
               </router-link>
               <router-link to="/about">
                  <div class="menu__link">
                     <div class="menu__icon">
                        <svg width="1414" height="1704" viewBox="0 0 1414 1704" fill="none" xmlns="http://www.w3.org/2000/svg">
                           <path d="M1253.48 0H161.702C72.889 0 0 71.166 0 159.98V1542.46C0 1631.28 72.889 1704 161.702 1704H803.392C820.916 1704 837.721 1696.81 850.111 1684.42L1394.92 1139.21C1407.31 1126.83 1414 1109.9 1414 1092.38V159.981C1414 71.166 1342.29 0 1253.48 0ZM132 1542.46V159.98C132 144.027 145.752 132 161.702 132H1253.48C1269.43 132 1282 144.027 1282 159.98V994H865.354C776.542 994 704 1065.53 704 1154.34V1572H161.702C145.752 1572 132 1558.42 132 1542.46ZM836 1510.99V1154.34C836 1138.39 849.403 1126 865.354 1126H1222L836 1510.99Z" fill="black"/>
                        </svg>
                     </div>
                     <span class="menu__text">About</span>
                  </div>
               </router-link>
               <router-link to="/settings/account" v-if="isTokenActive">
                  <div class="menu__link">
                     <div class="menu__icon">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                           <path d="M30.391 12.68L27.327 12.066C27.173 11.623 26.991 11.193 26.79 10.777L28.526 8.17295C29.055 7.37995 28.95 6.32295 28.276 5.64995L26.352 3.72595C25.965 3.33895 25.454 3.13995 24.936 3.13995C24.553 3.13995 24.166 3.24995 23.829 3.47595L21.225 5.21095C20.807 5.00895 20.377 4.82895 19.934 4.67495L19.32 1.60995C19.134 0.673953 18.312 0.00195312 17.359 0.00195312H14.639C13.686 0.00195312 12.865 0.674953 12.678 1.60995L12.064 4.67495C11.621 4.82895 11.191 5.00995 10.775 5.21095L8.172 3.47595C7.833 3.24995 7.447 3.13995 7.063 3.13995C6.546 3.13995 6.035 3.33895 5.648 3.72595L3.725 5.64995C3.051 6.32395 2.946 7.37995 3.475 8.17295L5.21 10.777C5.008 11.194 4.828 11.624 4.674 12.067L1.608 12.68C0.673 12.867 0 13.688 0 14.641V17.361C0 18.314 0.673 19.136 1.608 19.322L4.673 19.937C4.827 20.38 5.008 20.81 5.209 21.226L3.475 23.83C2.946 24.623 3.051 25.68 3.725 26.353L5.649 28.277C6.036 28.664 6.547 28.863 7.064 28.863C7.448 28.863 7.835 28.752 8.172 28.527L10.776 26.791C11.193 26.994 11.623 27.174 12.066 27.328L12.679 30.392C12.866 31.328 13.687 32.001 14.64 32.001H17.36C18.313 32.001 19.135 31.327 19.321 30.392L19.936 27.328C20.379 27.174 20.809 26.992 21.225 26.791L23.829 28.527C24.167 28.752 24.554 28.863 24.936 28.863C25.454 28.863 25.965 28.664 26.352 28.277L28.276 26.353C28.95 25.679 29.055 24.623 28.526 23.83L26.79 21.226C26.993 20.808 27.173 20.378 27.327 19.935L30.391 19.322C31.326 19.137 32 18.314 32 17.361V14.641C32 13.688 31.326 12.867 30.391 12.68ZM26.934 17.975C26.239 18.114 25.67 18.61 25.438 19.28C25.309 19.649 25.159 20.007 24.991 20.354C24.68 20.993 24.733 21.747 25.126 22.336L26.862 24.94L24.938 26.864L22.334 25.128C22 24.905 21.613 24.792 21.225 24.792C20.928 24.792 20.629 24.858 20.354 24.991C20.006 25.159 19.649 25.311 19.278 25.44C18.61 25.672 18.114 26.241 17.975 26.936L17.36 30.002H14.64L14.027 26.936C13.888 26.241 13.392 25.672 12.723 25.44C12.354 25.311 11.995 25.161 11.648 24.993C11.372 24.858 11.074 24.792 10.776 24.792C10.387 24.792 10.001 24.905 9.667 25.128L7.063 26.864L5.139 24.94L6.874 22.336C7.267 21.746 7.318 20.992 7.011 20.356C6.843 20.008 6.692 19.651 6.563 19.28C6.331 18.612 5.761 18.116 5.067 17.977L2.002 17.362L2 14.641L5.066 14.028C5.76 13.889 6.33 13.393 6.562 12.724C6.691 12.355 6.84 11.996 7.009 11.649C7.319 11.011 7.267 10.257 6.873 9.66795L5.139 7.06395L7.062 5.13995L9.666 6.87495C10 7.09795 10.387 7.21095 10.775 7.21095C11.072 7.21095 11.37 7.14495 11.646 7.01195C11.993 6.84395 12.351 6.69295 12.721 6.56395C13.39 6.33195 13.886 5.76195 14.025 5.06795L14.639 2.00295L17.359 2.00195L17.972 5.06795C18.111 5.76195 18.607 6.33195 19.277 6.56395C19.646 6.69295 20.004 6.84195 20.351 7.01095C20.628 7.14495 20.925 7.21095 21.224 7.21095C21.613 7.21095 21.999 7.09795 22.333 6.87495L24.937 5.13995L26.861 7.06395L25.125 9.66795C24.732 10.258 24.682 11.011 24.988 11.648C25.156 11.995 25.308 12.353 25.437 12.723C25.669 13.392 26.238 13.888 26.933 14.027L29.997 14.641L30 17.361L26.934 17.975Z" fill="#333333"/>
                           <path d="M16 9.00098C12.135 9.00098 9 12.136 9 16.001C9 19.867 12.135 23.001 16 23.001C19.865 23.001 23 19.866 23 16.001C23 12.136 19.865 9.00098 16 9.00098ZM16 22.127C12.618 22.127 9.875 19.383 9.875 16.002C9.875 12.62 12.618 9.87698 16 9.87698C19.381 9.87698 22.125 12.62 22.125 16.002C22.125 19.383 19.381 22.127 16 22.127Z" fill="#333333"/>
                           <path d="M16 12.001C13.79 12.001 12 13.791 12 16.001C12 18.21 13.79 20.001 16 20.001C18.209 20.001 20 18.21 20 16.001C20 13.792 18.209 12.001 16 12.001ZM16 19.002C14.344 19.002 13 17.658 13 16.002C13 14.346 14.344 13.002 16 13.002C17.656 13.002 19 14.346 19 16.002C19 17.658 17.656 19.002 16 19.002Z" fill="#333333"/>
                        </svg>
                     </div>
                     <span class="menu__text">Settings</span>
                  </div>
               </router-link>
            </nav> 
         </div>
      </div>
  </aside>
</template>
<script>
//========================================================================================================================================================
import { ref, onMounted } from 'vue'
import { useStore } from 'vuex'
//styles========================================================================================================================================================
import '@/components/Sidebar/sidebar-main.scss'
import '@/components/Sidebar/SidebarDropdown/sidebar-dropdown.scss'
import '@/components/Sidebar/SidebarMenu/sidebar-menu.scss'
//========================================================================================================================================================
export default {
   setup() {
      const user = ref({})
      const store = useStore()
      const isTokenActive = ref(localStorage.getItem('jwt_token'))
      
      // sidebar functional
      const isToggled = ref(localStorage.getItem('isToggled') === "true")
      const isDropdowned = ref(false)
      const menuToggle = () => {
         isToggled.value = !isToggled.value
         localStorage.setItem('isToggled', isToggled.value)
      }
      const openDropdown = () => {
         isToggled.value = true
         isDropdowned.value = true
      }
      const closeDropdown = () => {
         isDropdowned.value = false
      }
      
      // get user info
      onMounted( async () => {
         if(isTokenActive.value) {
            user.value = await store.dispatch('auth/toUser')
         }
      })
     
      return {
         user,
         isTokenActive,
         isToggled,
         menuToggle,
         isDropdowned,
         openDropdown,
         closeDropdown
      }
   }
}

</script>